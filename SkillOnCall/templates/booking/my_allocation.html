{% extends '../base.html' %}

{% block title %}
    My Allocation
{% endblock %}

{% block content %}
<div class="container my-5">
    <h2 class="text-center mb-5 fw-bold">Your Service Bookings</h2>

    {% if bookings %}
        {% if pending_bookings %}
        <h5 class="mb-3 text-warning"><i class="bi bi-hourglass-split me-1"></i>Pending Services</h5>
        <div class="table-responsive mb-4">
            <table class="table table-sm table-hover align-middle">
                <thead class="table-warning text-dark">
                    <tr>
                        <th>Booking ID</th>
                        <th>Customer</th>
                        <th>Booked On</th>
                        <th>Services</th>
                        <th>Description</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for booking in pending_bookings %}
                    <tr>
                        <td>#{{ booking.booking_id }}</td>
                        <td>{{ booking.service_provider_id.customer.user.username }}</td>
                        <td>{{ booking.booking_date|date:"M d, Y h:i A" }}</td>
                        <td>
                            {% for service in booking.service_id.all %}
                                <span class="badge bg-light text-dark border">{{ service.name }}</span>
                            {% endfor %}
                        </td>
                        <td>{{ booking.description_of_problem|truncatechars:50 }}</td>
                        <td>
                            <a href="#" class="btn btn-sm btn-outline-primary">View</a>
                            <a href="{% url 'accept_booking' booking.access_token %}" class="btn btn-sm btn-outline-success">Accept</a>
                            <a href="{% url 'decline_booking' booking.access_token %}" class="btn btn-sm btn-outline-danger">Decline</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}

        {% if confirmed_bookings %}
        <h5 class="mb-3 text-success"><i class="bi bi-check-circle-fill me-1"></i>Confirmed Services</h5>
        <div class="table-responsive mb-4">
            <table class="table table-sm table-hover align-middle">
                <thead class="table-success text-dark">
                    <tr>
                        <th>Booking ID</th>
                        <th>Customer</th>
                        <th>Booked On</th>
                        <th>Services</th>
                        <th>Description</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for booking in confirmed_bookings %}
                    <tr>
                        <td>#{{ booking.booking_id }}</td>
                        <td>{{ booking.service_provider_id.customer.user.username }}</td>
                        <td>{{ booking.booking_date|date:"M d, Y h:i A" }}</td>
                        <td>
                            {% for service in booking.service_id.all %}
                                <span class="badge bg-light text-dark border">{{ service.name }}</span>
                            {% endfor %}
                        </td>
                        <td>{{ booking.description_of_problem|truncatechars:50 }}</td>
                        <td>
                            <a href="#" class="btn btn-sm btn-outline-primary">View</a>
                            <a href="#" class="btn btn-sm btn-outline-success">Complete</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}

        {% if cancelled_bookings %}
        <h5 class="mb-3 text-danger"><i class="bi bi-x-circle-fill me-1"></i>Cancelled Services</h5>
        <div class="table-responsive mb-4">
            <table class="table table-sm table-hover align-middle">
                <thead class="table-danger text-dark">
                    <tr>
                        <th>Booking ID</th>
                        <th>Customer</th>
                        <th>Booked On</th>
                        <th>Services</th>
                        <th>Description</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for booking in cancelled_bookings %}
                    <tr>
                        <td>#{{ booking.booking_id }}</td>
                        <td>{{ booking.service_provider_id.customer.user.username }}</td>
                        <td>{{ booking.booking_date|date:"M d, Y h:i A" }}</td>
                        <td>
                            {% for service in booking.service_id.all %}
                                <span class="badge bg-light text-dark border">{{ service.name }}</span>
                            {% endfor %}
                        </td>
                        <td>{{ booking.description_of_problem|truncatechars:50 }}</td>
                        <td>
                            <a href="#" class="btn btn-sm btn-outline-primary">View</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}

        {% if completed_bookings %}
        <h5 class="mb-3 text-info"><i class="bi bi-patch-check-fill me-1"></i>Completed Services</h5>
        <div class="table-responsive mb-4">
            <table class="table table-sm table-hover align-middle">
                <thead class="table-info text-dark">
                    <tr>
                        <th>Booking ID</th>
                        <th>Customer</th>
                        <th>Booked On</th>
                        <th>Services</th>
                        <th>Description</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for booking in completed_bookings %}
                    <tr>
                        <td>#{{ booking.booking_id }}</td>
                        <td>{{ booking.service_provider_id.customer.user.username }}</td>
                        <td>{{ booking.booking_date|date:"M d, Y h:i A" }}</td>
                        <td>
                            {% for service in booking.service_id.all %}
                                <span class="badge bg-light text-dark border">{{ service.name }}</span>
                            {% endfor %}
                        </td>
                        <td>{{ booking.description_of_problem|truncatechars:50 }}</td>
                        <td>
                            <a href="#" class="btn btn-sm btn-outline-primary">View</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}
    {% else %}
    <div class="alert alert-info text-center" role="alert">
        <i class="bi bi-info-circle-fill"></i> You have not been assigned any bookings yet.
    </div>
    {% endif %}
</div>
{% endblock %}
